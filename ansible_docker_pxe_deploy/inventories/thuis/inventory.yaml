---
all:
  vars:
    docker_deploy:
      volume_pxe: "/home/opvolger/pxe/volume_pxe"
      dir: "/home/opvolger/pxe"    
    wimboot:
      generate: false
      download_with_samba: true
    boot_ipxe:
      ip_address: "192.168.2.17"
      dhcp_range_for_pxe_boot: "192.168.2.150"
      download_png: https://github.com/bradgillap/IPXEBOOT/raw/master/boot.png
      samba: '{{ samba }}'
      nfs: '{{ nfs }}'
      menu_default: ubuntu
      menu_os_items:
        linux:
          - name_item: ubuntu
            name_os: ubuntu
            version: "20.04.1"
            arch: amd64
            iso:
              name: ubuntu-20.04.1-desktop-amd64.iso
              download: https://releases.ubuntu.com/20.04/ubuntu-20.04.1-desktop-amd64.iso
              extract_to: samba
              bootfiles:
                - casper/vmlinuz
                - casper/initrd
            key: u
            text: (u) Boot Ubuntu 20.04.1 (64) (from samba)
            boot_commands:
            # http://${ipxe_server_ip}/boot/{{ name_os }}/{{ version}}/{{ amd64 }} # TODO to readme
              - kernel http://${ipxe_server_ip}/boot/ubuntu/20.04.1/amd64/vmlinuz showmounts toram root=/dev/cifs boot=casper netboot=cifs nfsroot=//${samba_hostname}/${samba_share}/iso/ubuntu/64  NFSOPTS=-ouser=${samba_username},pass=${samba_password} ip=dhcp ro
              - initrd http://${ipxe_server_ip}/boot/ubuntu/20.04.1/amd64/initrd

          - name_item: ubuntu2
            name_os: ubuntu
            version: "20.04.1"
            arch: amd64
            # no iso here, because it already comes with the item above
            key: "2"
            text: (2) Boot Ubuntu 20.04.1 (64) (from nfs)
            boot_commands:
              - kernel http://${ipxe_server_ip}/boot/ubuntu/20.04.1/amd64/vmlinuz showmounts toram boot=casper root=/dev/nfs netboot=nfs nfsroot=${nfs_hostname}:${nfs_share}/iso/ubuntu/64 NFSOPTS=vers=3 ip=dhcp
              - initrd http://${ipxe_server_ip}/boot/ubuntu/20.04.1/amd64/initrd           
        windows:
          - name_item: windows10setup
            name_os: windows
            version: "10_home_pro_en"
            arch: amd64
            iso:
              name: Windows.iso
              extract_to: samba
            key: w
            text: (w) Boot Windows 10 Setup (from samba)
            boot_commands:
              - cpuid --ext 29 && set arch amd64 || set arch x86
              - kernel http://${ipxe_server_ip}/ipxe/wimboot
              - initrd http://${ipxe_server_ip}/boot/windows/10_home_pro_en/amd64/winpeshl.ini           winpeshl.ini
              - initrd http://${ipxe_server_ip}/boot/windows/10_home_pro_en/amd64/startup.ps1            startup.ps1
              - initrd http://${ipxe_server_ip}/winpe/${arch}/media/Boot/BCD                             BCD
              - initrd http://${ipxe_server_ip}/winpe/${arch}/media/Boot/boot.sdi                        boot.sdi
              - initrd http://${ipxe_server_ip}/winpe/${arch}/media/sources/boot.wim                     boot.wim
    # samba and nfs on the same nas
    nas:
      hostname: "192.168.2.13"
      share: "boot"
      username: "boot"
      password: !vault |
          $ANSIBLE_VAULT;1.2;AES256;thuis
          37666133336534363836323032623236643537366338383739353561666332633730366365386632
          6338313233313433616136303939333236633866313632390a613038393362326235343133383364
          61626237313563333362376465376361326635316337376333373265663763393032306337316431
          6237373131326534300a353438646436386535333461643738323062323263653438346534363835
          3864
    nfs:
      hostname: "{{ nas.hostname }}"
      share: "/volume1/{{ nas.share }}"
    samba:
      hostname: "{{ nas.hostname }}"
      share: "{{ nas.share }}"
      username: "{{ nas.username }}"
      password: "{{ nas.password }}"
  children:
    deploy:
      hosts:
        "192.168.2.17":
    compile:
      hosts:
        dummy: # all to localhost
    windows:
      hosts:
        "192.168.2.38":
    windows_adk:
      hosts:
        "192.168.2.38":
